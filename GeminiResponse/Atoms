import React, { ButtonHTMLAttributes, InputHTMLAttributes, HTMLAttributes } from 'react';

// --- SPINNER ---
export function Spinner({ size = 'md', className = '' }: { size?: 'sm' | 'md' | 'lg', className?: string }) {
  const sizes = { sm: 'w-4 h-4', md: 'w-6 h-6', lg: 'w-8 h-8' };
  
  return (
    <svg 
      className={`animate-spin text-current ${sizes[size]} ${className}`} 
      xmlns="http://www.w3.org/2000/svg" 
      fill="none" 
      viewBox="0 0 24 24"
    >
      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  );
}

// --- BUTTON ---
export interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'ghost';
  fullWidth?: boolean;
  loading?: boolean;
  icon?: React.ReactNode;
}

export function Button({ 
  children, 
  variant = 'primary', 
  fullWidth, 
  loading, 
  className = '', 
  disabled,
  icon,
  ...rest 
}: ButtonProps) {
  
  const baseStyles = "relative inline-flex items-center justify-center gap-2 rounded-lg font-medium transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 active:scale-[0.98] disabled:active:scale-100 disabled:cursor-not-allowed disabled:opacity-60 min-h-[48px] px-6 py-2 text-base";
  
  const variants = {
    primary: "bg-sage-400 hover:bg-sage-500 text-olive-900 shadow-sm focus-visible:ring-sage-400",
    secondary: "bg-white border border-sage-300 text-olive-700 hover:bg-sage-50 hover:border-sage-400 focus-visible:ring-sage-400",
    ghost: "bg-transparent text-olive-600 hover:text-olive-900 hover:bg-olive-50/50"
  };

  const widthClass = fullWidth ? 'w-full' : '';

  return (
    <button 
      className={`${baseStyles} ${variants[variant]} ${widthClass} ${className}`}
      disabled={disabled || loading}
      {...rest}
    >
      {loading ? (
        <>
          <Spinner size="sm" />
          <span>Calculando...</span>
        </>
      ) : (
        <>
          {icon && <span className="w-5 h-5">{icon}</span>}
          {children}
        </>
      )}
    </button>
  );
}

// --- CARD ---
export interface CardProps extends HTMLAttributes<HTMLDivElement> {
  variant?: 'default' | 'outlined' | 'flat';
  padding?: 'none' | 'small' | 'medium' | 'large';
  highlight?: 'none' | 'success';
}

export function Card({ 
  children, 
  variant = 'default', 
  padding = 'medium', 
  highlight = 'none',
  className = '', 
  ...rest 
}: CardProps) {
  
  const baseStyles = "rounded-2xl transition-all duration-300";
  
  const variants = {
    default: "bg-white shadow-soft border border-olive-50",
    outlined: "bg-transparent border border-olive-200",
    flat: "bg-olive-50/50 border border-transparent"
  };

  const paddings = {
    none: "",
    small: "p-4",
    medium: "p-6",
    large: "p-8"
  };

  const highlights = {
    none: "",
    success: "ring-2 ring-sage-400 bg-sage-50/30 relative overflow-hidden" // Badge logic would go inside content
  };

  return (
    <div 
      className={`${baseStyles} ${variants[variant]} ${paddings[padding]} ${highlights[highlight]} ${className}`}
      {...rest}
    >
      {highlight === 'success' && (
        <div className="absolute top-0 right-0 bg-sage-400 text-olive-900 text-xs font-bold px-3 py-1 rounded-bl-lg">
          Melhor Opção
        </div>
      )}
      {children}
    </div>
  );
}

// --- LABEL ---
export function Label({ children, htmlFor, className = '', required }: { children: React.ReactNode, htmlFor?: string, className?: string, required?: boolean }) {
  return (
    <label htmlFor={htmlFor} className={`block text-sm font-medium text-olive-700 mb-1.5 ${className}`}>
      {children}
      {required && <span className="text-status-error ml-1">*</span>}
    </label>
  );
}

// --- INPUT ---
export interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  error?: boolean;
  fullWidth?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

export function Input({ 
  className = '', 
  error, 
  fullWidth = true, 
  leftIcon,
  rightIcon,
  disabled,
  ...rest 
}: InputProps) {
  
  const baseStyles = "block rounded-lg border text-olive-900 placeholder:text-olive-300 focus:outline-none focus:ring-2 focus:ring-offset-0 transition-all duration-200 min-h-[48px] sm:text-sm text-base"; // text-base on mobile prevents zoom
  
  const stateStyles = error 
    ? "border-status-error/50 focus:border-status-error focus:ring-status-error/20 bg-red-50/10" 
    : "border-olive-200 hover:border-olive-300 focus:border-sage-400 focus:ring-sage-400/20 bg-white";

  const disabledStyles = disabled ? "opacity-60 bg-olive-50 cursor-not-allowed" : "";
  const widthClass = fullWidth ? 'w-full' : '';
  const paddingLeft = leftIcon ? 'pl-10' : 'pl-4';
  const paddingRight = rightIcon ? 'pr-10' : 'pr-4';

  return (
    <div className={`relative ${widthClass}`}>
      {leftIcon && (
        <div className="absolute left-3 top-1/2 -translate-y-1/2 text-olive-400 pointer-events-none">
          {leftIcon}
        </div>
      )}
      <input 
        className={`${baseStyles} ${stateStyles} ${disabledStyles} ${widthClass} ${paddingLeft} ${paddingRight} py-2.5 ${className}`}
        disabled={disabled}
        {...rest}
      />
      {rightIcon && (
        <div className="absolute right-3 top-1/2 -translate-y-1/2 text-olive-400">
          {rightIcon}
        </div>
      )}
    </div>
  );
}